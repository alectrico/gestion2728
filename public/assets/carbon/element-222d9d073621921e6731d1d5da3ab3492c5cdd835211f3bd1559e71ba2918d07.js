!function(){"use strict";Carbon.Element=function(e){Object.defineProperties(this,{_config:{value:e||{}},_properties:{value:{}},_bindings:{value:{}},_debouncers:{value:{}},_listeners:{value:{}},_parents:{value:[]},_children:{value:{}},_ready:{value:!1,writable:!0}}),this.registerProperties({uuid:{type:String,observer:"_uuidChanged"}}),setTimeout(function(){this.ready&&this.ready(),this._ready=!0}.bind(this))},Carbon.Element.prototype.registerProperty=function(e,t,i){this._properties[e]===undefined?this._properties[e]=new Carbon.Property(this,e,t):this._properties[e].define(t);var n=this._properties[e];i instanceof Array&&i[0]instanceof Carbon.Element&&"string"==typeof i[1]?i[0]._ready?n["default"]=i[0][i[1]]:n["default"]=i[0]._config[i[1]]:i&&(n["default"]=i);var r;if(!this.hasOwnProperty(e)){var s={key:e,element:this};Object.defineProperty(this,e,{get:function(){return n.value},set:function(t){n.value!==t&&(r=n.value,n.setValue(t),r instanceof Carbon.Element&&(r._parents.splice(r._parents.indexOf(s),1),delete this._children[e]),t instanceof Carbon.Element&&(t._parents.push(s),this._children[e]=t),n.observer!==undefined&&(this._ready?this[n.observer].call(this,{value:t,oldValue:r}):this.debounce(n._path+"-init",function(){this[n.observer].call(this,{value:t,oldValue:r})}.bind(this))),!0===n.notify&&this.dispatchEvent({type:n._path+"-changed",key:e,value:t,oldValue:r}))},enumerable:n.enumerable})}i instanceof Array&&i[0]instanceof Carbon.Element&&"string"==typeof i[1]&&(i[0]._ready?i[0].bindProperty(i[1],this,e):this.debounce("bind-property"+e,function(){i[0].bindProperty(i[1],this,e)}.bind(this))),n.persist?this[e]=n.getPersistedValue():this[e]=n["default"]},Carbon.Element.prototype.registerProperties=function(e){for(var t in e){var i=e[t],n=this._config[t];this.registerProperty(t,i,n)}},Carbon.Element.prototype.bindProperty=function(e,t,i){t instanceof HTMLElement&&(t._properties=t._properties||{},t._properties[i]=new Carbon.Property(t,i,{}));var n=this,r=this._properties[e]._path;this._properties[e].notify=!0,t._properties[i].notify=!0,this._bindings[r]={source:n,target:t,sourcePath:n._properties[e]._path,targetPath:t._properties[i]._path,sourceObserver:function(){t[i]=n[e]},targetObserver:function(){n[e]=t[i]}},n.addEventListener(this._bindings[r].sourcePath+"-changed",this._bindings[r].sourceObserver),t.addEventListener(this._bindings[r].targetPath+"-changed",this._bindings[r].targetObserver),n[e]!==undefined?t[i]=n[e]:t[i]!==undefined&&(n[e]=t[i])},Carbon.Element.prototype.addEventListener=function(e,t){this._listeners[e]===undefined&&(this._listeners[e]=[],this._listeners[e].regExp=new RegExp("^"+e.replace(/[*]/g,".*").toLowerCase().trim()+"$")),-1===this._listeners[e].indexOf(t)&&this._listeners[e].push(t)},Carbon.Element.prototype.removeEventListener=function(e,t){if(this._listeners[e]!==undefined){var i=this._listeners[e].indexOf(t);if(-1!==i)return void this._listeners[e].splice(i,1)}console.warn("Carbon.Element: Could not find listener",e)},Carbon.Element.prototype.removeEventListeners=function(e){if("string"==typeof e&&this._listeners[e]!==undefined&&(this._listeners[e].length=0),"function"==typeof e)for(var t in this._listeners){var i=this._listeners[t].indexOf(e);-1!==i&&this._listeners[t].splice(i,1)}},Carbon.Element.prototype.dispatchEvent=function(e){var t=e.type,i=[];for(var n in this._listeners)this._listeners[n].regExp.test(t)&&(i=i.concat(this._listeners[n]));if(e.target=e.target||this,i!==undefined)for(var r=0;r<i.length;r++)i[r].call(this,e);if(!0===e.bubble)for(var s=0;s<this._parents.length;s++)e.type=this._parents[s].key+"."+t,this._parents[s].element.dispatchEvent(e)},Carbon.Element.prototype.debounce=function(e,t,i){window.clearTimeout(this._debouncers[e]),this._debouncers[e]=setTimeout(function(){t(),delete this._debouncers[e]}.bind(this),i)},Carbon.Element.prototype._uuidChanged=function(){for(var e in this._properties)this._properties[e].persist&&(this[e]=this._properties[e].getPersistedValue())},Carbon.Element.prototype.dispose=function(){for(var e in this._config)delete this._config[e];for(e in this._properties)delete this._properties[e];for(e in this._bindings)this._bindings[e].source.removeEventListener(this._bindings[e].sourcePath+"-changed",this._bindings[e].sourceObserver),this._bindings[e].target.removeEventListener(this._bindings[e].targetPath+"-changed",this._bindings[e].targetObserver),delete this._bindings[e];for(e in this._debouncers)window.clearTimeout(this._debouncers[e]),delete this._debouncers[e];for(e in this._listeners){for(var t=this._listeners[e].length;t--;)this.removeEventListener(e,this._listeners[e][t]);delete this._listeners[e]}this._parents.length=0;for(e in this._children)delete this._children[e]}}();